{
  "annotations": { "list": [] },
  "editable": false,
  "graphTooltip": 1,
  "panels": [
    {
      "title": "Traces Received / sec",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": { "defaults": { "unit": "ops" }, "overrides": [] },
      "targets": [
        {
          "expr": "sum(rate(tempo_distributor_spans_received_total[5m]))",
          "legendFormat": "Spans Received/s",
          "refId": "A"
        }
      ]
    },
    {
      "title": "Ingestion Rate",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": { "defaults": { "unit": "Bps" }, "overrides": [] },
      "targets": [
        {
          "expr": "sum(rate(tempo_distributor_bytes_received_total[5m]))",
          "legendFormat": "Bytes/s",
          "refId": "A"
        }
      ]
    },
    {
      "title": "Trace Latency (p50 / p95 / p99)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(tempo_distributor_ingester_append_failures_bucket[5m])) by (le))",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(tempo_request_duration_seconds_bucket{route=~\"/tempo.*\"}[5m])) by (le))",
          "legendFormat": "p95 query latency",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(tempo_request_duration_seconds_bucket{route=~\"/tempo.*\"}[5m])) by (le))",
          "legendFormat": "p99 query latency",
          "refId": "C"
        }
      ]
    },
    {
      "title": "Tempo Compaction",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
      "targets": [
        {
          "expr": "sum(rate(tempo_compactor_blocks_total[5m]))",
          "legendFormat": "Blocks Compacted/s",
          "refId": "A"
        },
        {
          "expr": "tempo_compactor_outstanding_blocks",
          "legendFormat": "Outstanding Blocks",
          "refId": "B"
        }
      ]
    },
    {
      "title": "Tempo Blocks in Backend",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 16 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": { "color": { "mode": "thresholds" }, "thresholds": { "steps": [{ "color": "green", "value": null }] } },
        "overrides": []
      },
      "targets": [
        {
          "expr": "sum(tempo_backend_block_count) or vector(0)",
          "legendFormat": "Blocks",
          "refId": "A"
        }
      ]
    },
    {
      "title": "Tempo WAL Size",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 16 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": { "unit": "bytes", "color": { "mode": "thresholds" }, "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 536870912 }] } },
        "overrides": []
      },
      "targets": [
        {
          "expr": "sum(tempo_ingester_live_traces) or vector(0)",
          "legendFormat": "Live Traces",
          "refId": "A"
        }
      ]
    },
    {
      "title": "Request Errors",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 16 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
      "targets": [
        {
          "expr": "sum by (route, status_code) (rate(tempo_request_duration_seconds_count{status_code=~\"5..\"}[5m]))",
          "legendFormat": "{{route}} ({{status_code}})",
          "refId": "A"
        }
      ]
    },
    {
      "title": "Recent Traces",
      "type": "table",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 24 },
      "datasource": { "type": "tempo", "uid": "tempo" },
      "targets": [
        {
          "queryType": "traceql",
          "query": "{status = error || duration > 100ms}",
          "limit": 20,
          "tableType": "traces",
          "refId": "A"
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "tags": ["tempo", "traces"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "title": "Tempo - Traces Overview",
  "uid": "tempo-traces-overview"
}
